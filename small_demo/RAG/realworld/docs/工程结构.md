# RealWorld RAG 工程结构说明

本文档描述了 RealWorld RAG 项目的完整工程结构和设计理念。

## 📁 当前项目结构

```
realworld/
├── __init__.py           # 根包初始化（版本定义）
├── config.json           # 配置文件
├── pyproject.toml        # 项目配置和依赖管理 (PEP 621)
├── requirements.txt      # 传统依赖文件 (向后兼容)
├── src/                  # 源码目录
│   └── realworld/        # 主包
│       ├── __init__.py   # 包导出
│       ├── rag_engine.py # RAG 引擎核心
│       ├── embedders.py  # 嵌入器接口和实现
│       ├── vector_store.py # 向量存储管理
│       ├── document_processor.py # 文档处理
│       ├── config.py     # 配置管理
│       ├── logger.py     # 日志配置
│       ├── cli/          # 命令行接口子包
│       │   ├── __init__.py
│       │   ├── cli.py    # CLI 实现
│       │   └── main.py   # 主入口演示
│       ├── cache/        # 缓存文件目录
│       └── logs/         # 日志文件目录
├── data/                 # 数据存储
│   ├── __init__.py
│   ├── documents/        # 示例文档
│   └── db/               # 向量数据库
├── docs/                 # 文档
│   ├── __init__.py
│   ├── README.md         # 项目文档
│   ├── config相关解读.md # 配置说明
│   └── 工程结构.md      # 工程结构说明
├── examples/             # 示例脚本
│   ├── __init__.py
│   ├── demo_embedders.py         # 嵌入器演示
│   ├── demo_embedding_modes.py   # 嵌入模式演示
│   └── gemini_example.py         # Gemini 使用示例
├── tests/                # 测试
│   └── test_rag.py       # 单元测试
├── logs/                 # 日志文件
└── cache/                # 缓存文件
```

## 🏗️ 设计原则

### 1. 现代 Python 打包标准

- 使用 `pyproject.toml` (PEP 621) 进行项目配置
- `src/` 布局确保干净的包结构
- setuptools 作为构建后端

### 2. 模块化架构

- **核心模块**：RAG 引擎、嵌入器、向量存储等核心功能
- **CLI 子包**：命令行接口，独立于核心功能
- **配置管理**：集中化配置，支持多种配置源

### 3. 清晰的职责分离

- `src/realworld/`：核心业务逻辑
- `tests/`：测试代码
- `examples/`：使用示例
- `docs/`：项目文档
- `data/`：数据文件

## 📦 包结构详解

### 核心包 (`src/realworld/`)

#### 主模块

- **`rag_engine.py`**: RAG 系统核心，整合所有组件
- **`embedders.py`**: 嵌入器抽象和实现（Ollama、LangChain、在线服务）
- **`vector_store.py`**: ChromaDB 向量存储管理
- **`document_processor.py`**: 文档加载、分块和处理
- **`config.py`**: 配置管理，支持环境变量、配置文件等
- **`logger.py`**: 日志系统配置

#### CLI 子包 (`cli/`)

- **`cli.py`**: 命令行接口实现
- **`main.py`**: 演示程序入口

### 辅助目录

#### 数据目录 (`data/`)

- `documents/`：存放示例文档
- `db/`：向量数据库存储位置

#### 示例目录 (`examples/`)

- 各种使用场景的演示代码
- 嵌入器对比测试
- API 使用示例

#### 测试目录 (`tests/`)

- 单元测试和集成测试
- 使用标准 `pytest` 框架

#### 文档目录 (`docs/`)

- README 和使用指南
- 配置说明
- API 文档

## 🔧 安装和使用

### 安装

```bash
# 开发模式安装
pip install -e .

# 可选依赖
pip install -e ".[langchain]"  # LangChain 支持
pip install -e ".[gemini]"     # Gemini 支持
```

### 使用

```bash
# 命令行工具
realworld-cli --help
realworld-cli add ./documents
realworld-cli query "你的问题"

# Python API
from realworld import RAGEngine
engine = RAGEngine()
result = engine.query("问题")
```

## 🎯 架构优势

### 1. 标准化的项目结构

- 符合 PEP 621 和现代 Python 最佳实践
- 清晰的文件组织和模块划分

### 2. 灵活的配置系统

- 支持多种配置方式（环境变量、JSON 配置文件）
- 运行时配置覆盖

### 3. 可扩展的嵌入器架构

- 统一的嵌入器接口
- 易于添加新的嵌入提供商

### 4. 完整的 CLI 支持

- 标准命令行接口
- 丰富的命令和选项

### 5. 全面的测试覆盖

- 单元测试和集成测试
- 持续集成支持

## 🚀 部署选项

### 开发环境

```bash
pip install -e ".[dev]"
```

### 生产环境

```bash
pip install .
```

### Docker 部署

```dockerfile
FROM python:3.10-slim
COPY . /app
WORKDIR /app
RUN pip install .
CMD ["realworld-cli", "stats"]
```

这个工程结构为 RealWorld RAG 项目提供了坚实的基础，支持从开发到生产的完整生命周期。
